<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Mediation & Re-Rate Restart Checker</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Mediation & Re-Rate Restart Checker</h1><br/><p><div class="codebox"><pre><span style="color:#0088ff;font-weight:400">#This script follows the Cherry Tree application ID and checks if it is ever restarted. </span><br /><span style="color:#0088ff;font-weight:400">#If Cherry Tree has been restarted, it is going to send an E-mail.</span><br /><br /><br /><span style="color:#0088ff;font-weight:400">#Initially: The script checks if any log file has ever been created in the same directory</span><br /><span style="color:#0088ff;font-weight:400">#At this point, the script creates the log file for the first time.</span><br /><br /><br /><br /><br /><span style="color:#0088ff;font-weight:400">#--------------------------------------------------PARAMETERS-----------------------------------------------------------</span><br /><span style="color:#0088ff;font-weight:400">#</span><br /><span style="color:#0088ff;font-weight:400">#</span><br /><span style="color:#0088ff;font-weight:400">#---Get Cherry Tree from Task Manager:----------------------------------------------------------------------------------</span><br />    <span style="color:#0088ff;font-weight:400">$prcs</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#ff9d00;font-weight:700">Get-Process</span> <span style="color:#333333;font-weight:400">-Name</span> <span style="color:#3ad900;font-weight:400">&quot;cherrytree&quot;</span><br /><span style="color:#0088ff;font-weight:400">#---END: Get Cherry Tree from Task Manager------------------------------------------------------------------------------</span><br /><span style="color:#0088ff;font-weight:400">#</span><br /><span style="color:#0088ff;font-weight:400">#</span><br /><span style="color:#0088ff;font-weight:400">#---Log file path:------------------------------------------------------------------------------------------------------</span><br />    <span style="color:#0088ff;font-weight:400">$log_file_path</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#3ad900;font-weight:400">&quot;D:\PowerShellApplications\cherry_tree_restart_checker\chery_tree_restart_checker.csv&quot;</span><br /><span style="color:#0088ff;font-weight:400">#---END: Log file path--------------------------------------------------------------------------------------------------</span><br /><span style="color:#0088ff;font-weight:400">#</span><br /><span style="color:#0088ff;font-weight:400">#</span><br /><span style="color:#0088ff;font-weight:400">#-----------------------------------------------END: PARAMETERS---------------------------------------------------------</span><br /><br /><br /><br /><br /><br /><br /><br /><span style="color:#0088ff;font-weight:400">#-------------------------------------------------------------FUNCTIONS-------------------------------------------------</span><br /><span style="color:#0088ff;font-weight:400">#</span><br /><span style="color:#0088ff;font-weight:400">#</span><br /><span style="color:#0088ff;font-weight:400">#E-Mail Sender----------------------------------------------------------------------------------------------------------</span><br /><span style="color:#ff9d00;font-weight:700">function</span> send_email(){<br />    <span style="color:#0088ff;font-weight:400">$sender_pwd_1</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#3ad900;font-weight:400">&quot;2.Burcu2.&quot;</span><br />    <span style="color:#0088ff;font-weight:400">$sender_pwd_2</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#ff9d00;font-weight:700">ConvertTo-SecureString</span> <span style="color:#0088ff;font-weight:400">$sender_pwd_1</span> <span style="color:#ff9d00;font-weight:700">-</span>AsPlainText <span style="color:#ff9d00;font-weight:700">-</span>Force<br />    <br />    <br />    <span style="color:#0088ff;font-weight:400">#Gönderen mail adresi:</span><br />    <span style="color:#0088ff;font-weight:400">$sender</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#3ad900;font-weight:400">&quot;celikoglu_burc@outlook.com&quot;</span><br /><br />    <span style="color:#0088ff;font-weight:400">#Alıcı mail adresi:</span><br />    <span style="color:#0088ff;font-weight:400">$receiver</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#3ad900;font-weight:400">&quot;clkbrcyedek@gmail.com&quot;</span><br /><br /><br />    <span style="color:#0088ff;font-weight:400">#Email Body:</span><br />    <span style="color:#0088ff;font-weight:400">$body</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#3ad900;font-weight:400">&quot;Cherry Tree has been restarted.&quot;</span><br /><br />    <span style="color:#0088ff;font-weight:400">$props</span> <span style="color:#ff9d00;font-weight:700">=</span> @{<br />        From <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#0088ff;font-weight:400">$sender</span><br />        To <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#0088ff;font-weight:400">$receiver</span><br />        Subject <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#3ad900;font-weight:400">&quot;PowerShell Test Mail 1&quot;</span><br />        UseSSL <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#0088ff;font-weight:400">$true</span><br />        Port <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#333333;font-weight:400">&#39;587&#39;</span><br />        Credential <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#ff9d00;font-weight:700">New-Object</span> System.Management.Automation.PSCredential(<span style="color:#0088ff;font-weight:400">$sender</span>, <span style="color:#0088ff;font-weight:400">$sender_pwd_2</span>)<br />        SMTP <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#3ad900;font-weight:400">&quot;smtp.office365.com&quot;</span><br />    }<br /><br /><br />    <span style="color:#ff9d00;font-weight:700">Send-MailMessage</span> @props <span style="color:#0088ff;font-weight:400">$body</span><br />}<br /><span style="color:#0088ff;font-weight:400">#END:E-Mail Sender:-------------------------------------------------------------------------------------------------------</span><br /><span style="color:#0088ff;font-weight:400">#</span><br /><span style="color:#0088ff;font-weight:400">#</span><br /><span style="color:#0088ff;font-weight:400">#</span><br /><span style="color:#0088ff;font-weight:400">#Create &amp; Update log file-------------------------------------------------------------------------------------------------</span><br /><span style="color:#ff9d00;font-weight:700">function</span> create_log_file{<br />    <br />    <span style="color:#ff9d00;font-weight:700">param</span>(<br />        [<span style="color:#ff9d00;font-weight:700">Parameter</span>(<span style="color:#ff9d00;font-weight:400">Position</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#333333;font-weight:400">0</span>)]<span style="color:#0088ff;font-weight:400">$log_file_path</span>,<br />        [<span style="color:#ff9d00;font-weight:700">Parameter</span>(<span style="color:#ff9d00;font-weight:400">Position</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#333333;font-weight:400">1</span>)]<span style="color:#0088ff;font-weight:400">$prcs</span>,<br />        [<span style="color:#ff9d00;font-weight:700">Parameter</span>(<span style="color:#ff9d00;font-weight:400">Position</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#333333;font-weight:400">2</span>)]<span style="color:#0088ff;font-weight:400">$type</span><br />    )<br /><br /><br />   <span style="color:#ff9d00;font-weight:700">if</span>(<span style="color:#0088ff;font-weight:400">$type</span> <span style="color:#ff9d00;font-weight:700">-eq</span> <span style="color:#333333;font-weight:400">0</span>){<br />        <span style="color:#0088ff;font-weight:400">$prcs</span> | <span style="color:#ff9d00;font-weight:700">Select-Object</span> Id, StartTime |<br />        <span style="color:#ff9d00;font-weight:700">Export-Csv</span> <span style="color:#0088ff;font-weight:400">$log_file_path</span> <span style="color:#ff9d00;font-weight:700">-</span>NoTypeInformation<br />   }<br />   <span style="color:#ff9d00;font-weight:700">else</span>{<br />           <br />        <span style="color:#0088ff;font-weight:400">$prcs</span> | <span style="color:#ff9d00;font-weight:700">Select-Object</span> Id, StartTime |<br />        <span style="color:#ff9d00;font-weight:700">Export-Csv</span> <span style="color:#0088ff;font-weight:400">$log_file_path</span> <span style="color:#ff9d00;font-weight:700">-</span>NoTypeInformation <span style="color:#ff9d00;font-weight:700">-</span>Force <span style="color:#ff9d00;font-weight:700">-</span>Append<br />   } <br />}<br /><span style="color:#0088ff;font-weight:400">#END: Create &amp; Update log file--------------------------------------------------------------------------------------------</span><br /><span style="color:#0088ff;font-weight:400">#</span><br /><span style="color:#0088ff;font-weight:400">#</span><br /><span style="color:#0088ff;font-weight:400">#</span><br /><span style="color:#0088ff;font-weight:400">#--------------------------------------------------------------END: FUNCTIONS---------------------------------------------</span><br /><br /><br /><br /><br /><br /><br /><span style="color:#0088ff;font-weight:400">#--------------------------------------------------------------------PROCESS----------------------------------------------</span><br /><br /><span style="color:#0088ff;font-weight:400">#Process 1: Mediation Service Check:</span><br /><span style="color:#ff9d00;font-weight:700">if</span>(<span style="color:#ff9d00;font-weight:700">-not</span> (<span style="color:#ff9d00;font-weight:700">Test-Path</span> <span style="color:#0088ff;font-weight:400">$log_file_path</span> )){<br /><br />        <span style="color:#ff9d00;font-weight:700">Write-Output</span> <span style="color:#3ad900;font-weight:400">&quot;Script is running for the first time&quot;</span><br />        create_log_file <span style="color:#0088ff;font-weight:400">$log_file_path</span> <span style="color:#0088ff;font-weight:400">$prcs</span> <span style="color:#333333;font-weight:400">0</span><br /><br />}<br /><span style="color:#ff9d00;font-weight:700">else</span>{<br />        <span style="color:#0088ff;font-weight:400">$log_file</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#ff9d00;font-weight:700">Import-Csv</span> <span style="color:#ff9d00;font-weight:700">-</span>Path <span style="color:#0088ff;font-weight:400">$log_file_path</span><br />    <br />            <span style="color:#ff9d00;font-weight:700">if</span>(<span style="color:#0088ff;font-weight:400">$log_file</span>[<span style="color:#333333;font-weight:400">0</span>].Id <span style="color:#ff9d00;font-weight:700">-eq</span> <span style="color:#0088ff;font-weight:400">$prcs</span>.Id){<br />                 <span style="color:#3ad900;font-weight:400">&quot;Same Process Running&quot;</span><br />                    create_log_file <span style="color:#0088ff;font-weight:400">$log_file_path</span> <span style="color:#0088ff;font-weight:400">$prcs</span> <span style="color:#333333;font-weight:400">1</span><br />            }<br />            <span style="color:#ff9d00;font-weight:700">else</span>{<br />                 <span style="color:#3ad900;font-weight:400">&quot;Process has been restarted&quot;</span><br />                    create_log_file <span style="color:#0088ff;font-weight:400">$log_file_path</span> <span style="color:#0088ff;font-weight:400">$prcs</span> <span style="color:#333333;font-weight:400">1</span><br />                    send_email<br />            }<br />}<br /><span style="color:#0088ff;font-weight:400">#END: Process 1: Mediation Service Check-----------------------------------------------------------------------------</span><br /><span style="color:#0088ff;font-weight:400">#</span><br /><span style="color:#0088ff;font-weight:400">#</span><br /><br /><span style="color:#0088ff;font-weight:400">#Process 2: Sorting the Log file entries descending:</span><br /><span style="color:#0088ff;font-weight:400">$log_file</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#ff9d00;font-weight:700">Import-Csv</span> <span style="color:#0088ff;font-weight:400">$log_file_path</span>  <br /><span style="color:#0088ff;font-weight:400">$log_file</span>| <span style="color:#ff9d00;font-weight:700">Sort-Object</span> StartTime <span style="color:#ff9d00;font-weight:700">-</span>Descending | <span style="color:#ff9d00;font-weight:700">Export-Csv</span> <span style="color:#0088ff;font-weight:400">$log_file_path</span> <span style="color:#ff9d00;font-weight:700">-</span>NoTypeInformation <br /><span style="color:#0088ff;font-weight:400">#END: Process 2: Sorting the Log file entries descending--------------------------------------------------------------</span><br /><span style="color:#0088ff;font-weight:400">#</span><br /><span style="color:#0088ff;font-weight:400">#</span><br /><span style="color:#0088ff;font-weight:400">#</span><br /><span style="color:#0088ff;font-weight:400">##--------------------------------------------------------END: PROCESS------------------------------------------------</span></pre></div></p><p></p><p></p><p></p><p></p><p>CleanUp Scripts içerisinde çalışacak.</p><p>178.22.10.28 → SipP Server kullanılmıyor olabilir. </p><p>xdr_in_files içerisinde dosya var mı yok mu onu kontrol etmek gerekiyor. </p><p> </p></div>
</body>
</html>
